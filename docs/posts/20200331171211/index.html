<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.65.2" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Clericpy" />
  <meta property="og:url" content="https://clericpy.github.io/blog/posts/20200331171211/" />
  <link rel="canonical" href="https://clericpy.github.io/blog/posts/20200331171211/" /><link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-png" /><script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/clericpy.github.io\/blog\/"
      },
      "articleSection" : "posts",
      "name" : "watchdogs: 随时关注网络世界的变化",
      "headline" : "watchdogs: 随时关注网络世界的变化",
      "description" : "项目介绍: ClericPy\/watchdogs",
      "inLanguage" : "en-US",
      "author" : "Clericpy",
      "creator" : "Clericpy",
      "publisher": "Clericpy",
      "accountablePerson" : "Clericpy",
      "copyrightHolder" : "Clericpy",
      "copyrightYear" : "2020",
      "datePublished": "2020-03-31 17:12:12 \x2b0800 CST",
      "dateModified" : "2020-03-31 17:12:12 \x2b0800 CST",
      "url" : "https:\/\/clericpy.github.io\/blog\/posts\/20200331171211\/",
      "keywords" : [  ]
  }
</script>
<title>watchdogs: 随时关注网络世界的变化 - Clericpy&#39;s Blog</title>
  <meta property="og:title" content="watchdogs: 随时关注网络世界的变化 - Clericpy&#39;s Blog" />
  <meta property="og:type" content="article" />
  <meta name="description" content="项目介绍: ClericPy/watchdogs" />

  <link rel="stylesheet" href="https://unpkg.com/flexboxgrid@6.3.1/dist/flexboxgrid.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/tomorrow.min.css" />
  <link rel="stylesheet" href="/blog/css/index.css">
  <link href="/blog/index.xml" rel="alternate" type="application/rss+xml" title="Clericpy&#39;s Blog">
  
  <link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker" rel="stylesheet">
  
  <script>
    

    (function (undefined) { }).call('object' === typeof window && window || 'object' === typeof self && self || 'object' === typeof global && global || {});
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-150991415-1"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag("js", new Date());  gtag("config", "UA-150991415-1");</script>
</head>


<body>
    <article class="post Chinese" id="article">
        <div class="row">
            <div class="col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-lg-6 col-lg-offset-3">
                <div class="site-header">
                    
<header>
  <div class="signatures site-title">
    <a href="/blog/">Clericpy&#39;s Blog</a>
  </div>
</header>
<div class="row end-xs">
  
  
</div>
<div class="header-line"></div>

                </div>
                <header class="post-header">
                    <h1 class="post-title">watchdogs: 随时关注网络世界的变化</h1>
                    
                    <div class="row post-desc">
                        <div class="col-xs-2">
                            
                            <time class="post-date" datetime="2020-03-31 17:12:12 CST">
                                31 Mar 2020
                            </time>
                            
                        </div>
                        <div class="col-xs-4">
                            <a href="/blog/categories/github"><b
                                    style="text-decoration:underline">Github</b></a>
                        </div>
                        <div class="col-xs-6">
                            
                            <div class="post-author">
                                <a target="_blank" href="https://github.com/ClericPy">@Clericpy</a>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div id="toc" class="well col-md-12 col-sm-10" style="font-size: 0.8em; border: 1px dashed rgb(194, 194, 194); margin: 15px; padding: 15px;">
                        <h3>Table of Contents</h3>
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#项目初衷">项目初衷</a></li>
    <li><a href="#主要功能">主要功能</a></li>
    <li><a href="#简单上手">简单上手</a></li>
    <li><a href="#详细使用">详细使用</a>
      <ul>
        <li><a href="#启动参数">启动参数</a></li>
        <li><a href="#web-界面">Web 界面</a></li>
        <li><a href="#tab-tasks">[Tab] Tasks</a></li>
        <li><a href="#tab-new">[Tab] New</a></li>
        <li><a href="#tab-rule">[Tab] Rule</a></li>
        <li><a href="#自定义使用">自定义使用</a></li>
      </ul>
    </li>
    <li><a href="#结语">结语</a></li>
  </ul>
</nav>
                    </div>
                </header>
                <div class="post-content markdown-body">
                    <blockquote>
<p>做爬虫的, 要有自己的工具来发现网络世界的动态, 对信息保持一份敏感, 对数据存有一颗敬畏之心.</p>
</blockquote>
<p>项目名称: <a href="https://github.com/ClericPy/watchdogs">ClericPy/watchdogs</a></p>
<h2 id="项目初衷">项目初衷</h2>
<ol>
<li>
<p>统一关注.</p>
<blockquote>
<p>平时可能会追剧追小说追综艺, 关注疫情实况, 订阅一些博客, 但是网站多了太分散, 所以需要一份 Timeline 方便浏览.</p>
</blockquote>
</li>
<li>
<p>解放双手.</p>
<blockquote>
<p>满足对日常信息变化的订阅, 并提供主动提醒功能, 从不断刷网页判断更新中解放双手. 简而言之, 信息索取由被动转为主动.</p>
</blockquote>
</li>
<li>
<p>体验新事物.</p>
<blockquote>
<p>而归根结底的初衷, 还是想试试去年就大火的 <strong><a href="https://github.com/tiangolo/fastapi">fastapi</a></strong>, 体验之后, 果然比原生 <strong><a href="https://github.com/encode/starlette">starlette</a></strong> 要优雅很多.</p>
</blockquote>
</li>
</ol>
<h2 id="主要功能">主要功能</h2>
<ol>
<li>适用于: 追剧, 追星, 追小说漫画, steam 降价, 博客更新, <strong>服务翻车</strong>, 疫情实况, 定向新闻或搜索结果等场景的提醒.</li>
<li>根据定制解析规则, 关注网页特定数据的变化, 记录更新时间与历史数据, 并提供对应 URL 进行跳转. 所有爬虫执行在协程环境下, 抓取 / 存储 / 回调与整个 Web 服务相互独立不阻塞.</li>
<li>通过可视化 Web UI 快速配置爬虫的下载器与解析器参数, 目前熟练操作以后, 配置一个抓取规则大约耗时 <strong>3 分钟</strong>.
<ol>
<li>结合前段时间写的解析规则持久化模块 <a href="https://github.com/ClericPy/uniparser">uniparser</a>, 将解析方式存储在数据库中, 避免每次新增爬虫都要发布代码. 该库虽然涵盖的解析方式很多, 但大部分库都是<strong>惰性</strong>引用, 开销并不算太大.</li>
<li>总的来说, 就是将大量爬虫解析器的耦合代码归纳起来, 然后把变量部分入库保存, 实现解析规则持久化.</li>
</ol>
</li>
<li>定制化提醒方式. 默认支持了『<strong>Server 酱</strong>』和 <strong>RSS</strong> 的订阅, 以及适配手机的 Lite 页面.
<ol>
<li><a href="https://sc.ftqq.com/">Server 酱</a> 是用来通过微信推送提醒的服务, 具体 Token 获取方式参考其官方网站.</li>
<li>RSS 网页的订阅可以使用专业的 RSS 阅读器应用或扩展. 之前使用的 <code>Inoreader</code> 和 <code>RSS Feed Reader</code> 因为刷新频率太低, 好暂时弃用. 而 Chrome 扩展 <a href="https://nodetics.com/feedbro/">feedbro</a> 则支持分钟级提醒.</li>
<li>至于 <strong>Email</strong> 等其他提醒方式, 可以凭借继承 <code>watchdogs.callbacks.Callback</code> 抽象类, 并实现 callback(task) 函数来完成.</li>
</ol>
</li>
<li>快速部署.</li>
<li>默认配置只需要 pip 安装后 <code>python3.7 -m watchdogs</code> 即可启动 Web App, 配置文件与日志文件存放在 $HOME/watchdogs 目录下, 若没有指定 <code>mysql</code> 的 <code>db_url</code>, 则使用 <code>sqlite</code> 数据库也存放在该目录.</li>
<li>内存占用大约 80 MB, Linux 系统下如果安装 <code>uvloop</code>, 性能非常顺畅.</li>
<li>也可以将 watchdogs 作为第三方库来进行私人订制, 只需要调制好 <code>watchdogs.Config</code> 中的各项原始变量, 然后执行 <code>watchdogs.init_app()</code> 即可拿到 <code>app: Fastapi</code> 对象, 该对象可以进行二次绑定 routes, 不过尽量不要作为 sub_app 使用, 否则会错过 startup 和 shutdown 事件的回调函数, 需要另行调用.</li>
</ol>
<h2 id="简单上手">简单上手</h2>
<ol>
<li>
<p>安装 (pip)</p>
<blockquote>
<p>pip install -U watchdogs</p>
</blockquote>
</li>
<li>
<p>部署 (python3.7+)</p>
<blockquote>
<p>python3.7 -m watchdogs</p>
</blockquote>
</li>
<li>
<p>使用</p>
<blockquote>
<p>通过浏览器访问相应地址即可</p>
</blockquote>
</li>
</ol>
<h2 id="详细使用">详细使用</h2>
<h3 id="启动参数">启动参数</h3>
<ul>
<li>查看帮助: <code>python -m watchdogs -- -h</code></li>
<li>以下参数除了命令行启动时使用, 作为第三方库引用时也可以使用, 而实际使用中在通过 <code>watchdogs.init_app</code> 初始化 app 实例前, 直接修改 <code>watchdogs.Config</code> 对应配置更方便.</li>
<li><strong>db_url</strong>: <code>sqlite / mysql / postgresql</code> 所支持的 <code>db_url</code>, 也就是 <a href="https://github.com/encode/databases">databases</a> 所支持的.</li>
</ul>
<blockquote>
<p>若是不指定, 则会使用 <code>sqlite:///$HOME/watchdogs/storage.sqlite</code></p>
<p>PostgreSQL 没有进行实机测试.</p>
</blockquote>
<ul>
<li><strong>password</strong>:</li>
</ul>
<blockquote>
<p>初始化的密码, 一般不需要指定, 除非密码被人给破了, 所以要提前指定进行修改, 否则在网页端就可以修改.</p>
</blockquote>
<ul>
<li><strong>mute_std_log</strong>:</li>
</ul>
<blockquote>
<p>忽略 <code>stdout, stderr</code> 上日志的显示</p>
</blockquote>
<ul>
<li><strong>mute_file_log</strong>:</li>
</ul>
<blockquote>
<p>日志不再保存到 $HOME/watchdogs 目录.</p>
</blockquote>
<ul>
<li><strong>md5_salt</strong>:</li>
</ul>
<blockquote>
<p>md5 加盐用的参数, 全局 md5 鉴权时使用, 一般不需要指定, 除非要多处部署分布式, 保证加盐统一.</p>
</blockquote>
<ul>
<li><strong>config_dir</strong>:</li>
</ul>
<blockquote>
<p>配置文件目录, 用来存放配置文件和日志文件的地方, 如果没有指定数据库, 则也会存放 <code>sqlite</code> 数据文件. 不指定的话, 默认为 $HOME/watchdogs</p>
</blockquote>
<ul>
<li><strong>use_default_cdn</strong>:</li>
</ul>
<blockquote>
<p>如果 Config.cdn_urls 没有指定, 并且指定了 use_default_cdn, 将使用来自 <a href="http://staticfile.org/">staticfile.org</a> 的在线 js / css CDN 链接.</p>
</blockquote>
<ul>
<li><strong>uvicorn_kwargs</strong>:</li>
</ul>
<blockquote>
<p><strong><a href="https://github.com/encode/uvicorn"> uvicorn</a></strong> 启动参数, 常用的有 port, host, access_log 等. 例如:</p>
<p><code>python -m watchdogs --port=9999 --host=127.0.0.1 --access-log=False</code></p>
</blockquote>
<h3 id="web-界面">Web 界面</h3>
<ul>
<li>通过 <code>python3.7 -m watchdogs</code> 启动时, 默认网页访问的是 http://127.0.0.1:9901
<ul>
<li>首次访问会有个配置新密码的过程.</li>
</ul>
</li>
<li>先看一下已经配置过的首页样式</li>
</ul>
<h3 id="tab-tasks">[Tab] Tasks</h3>
<blockquote>
<p>首页, 任务列表.</p>
</blockquote>
<p><img src="/blog/images/watchdogs_1.png" alt=""></p>
<ol>
<li>也就是首页. 直观展示全部任务列表, 每页默认 30 个.</li>
<li>新建任务的页面.</li>
<li>规则列表, 按照 host 分类.</li>
<li>由 <code>Config.custom_tabs</code> 变量配置的页面, 展示为一个自定义网址的 <code>iframe</code></li>
<li>由 <code>Config.custom_tabs</code> 变量配置的页面, 展示的是 <code>fastapi</code> 默认的 <code>/docs</code></li>
<li>任务列表的表头
<ol>
<li><code>task_id</code>: 自增数字, 用来做主键的.</li>
<li><code>name</code>: 任务名称, 唯一索引, 可以通过名字找到一个任务.</li>
<li><code>tag</code>: 任务的标签, 为下面的 RSS 和 lite 页面做的分类过滤, 也为当前任务列表做的过滤, 点击即可过滤.</li>
<li><code>request_args</code>: 请求参数, 是一个兼容 <code>requests / aiohttp</code> 库的字典, 同时支持 <code>retry</code>, <code>ssl</code> 等参数.</li>
<li><code>interval</code>: 抓取频率的参数, 类型为整型, 单位是秒.</li>
<li><code>work_hours</code>: 爬虫工作时间, 支持多种形式, 比如包含标准 <code>strftime</code> 格式的与或非逻辑(==, !=, &amp;, |).
<ol>
<li>0, 24: 表示当前小时处于 range(0, 24) 之间.</li>
<li>[18, 19, 20]: 表示每天的 18 19 20 这三个小时内才进行抓取.</li>
<li>%A==Friday: 表示每周五.</li>
<li>%m-%d==03-13: 每年的 3 月 13 日.</li>
<li>%H==05: 每天早上 05:00 ~ 05:59</li>
<li>%w==5;20, 24: 表示每周五的 20:00 ~ 23:59.</li>
<li>[1, 2, 15]&amp;%w==5: 每周五的 1 点 2 点和 15 点.</li>
<li>%w==5|%w==2: 每周二和周五.</li>
<li>%w!=6&amp;%w!=0: 只要不是周六或周日的任意一天.</li>
</ol>
</li>
<li><code>last_change_time</code>: 上次更新时间. 本链接点击后会展示三个属性: 上次抓取时间, 下次抓取时间, 上次更新时间.</li>
<li><code>custom_info</code>: 自定义信息. 这个会影响到抓取发现变化时候的回调, 分三种情况.
<ol>
<li>内容是无规律没有 <code>:</code> 的:
<ol>
<li>如果指定了 name 为 '&rsquo; 的 Callback, 则会唤起该回调函数进行处理本任务.</li>
<li>如果没有指定上述默认回调的话, 则该内容纯粹就是个笔记本记录一点描述.</li>
</ol>
</li>
<li>内容里有 <code>:</code>:
<ol>
<li>会按 <code>:</code> 进行一次 split, 左边是回调名称, 右边则是回调的参数, 具体回调可以通过继承 <code>watchdogs.callbacks.Callback</code> 自动绑定.</li>
<li>目前默认已经支持了的是 <code>server_chan</code>, 也就是 <a href="https://sc.ftqq.com/">Server 酱</a> 进行回调, 参数则是回车或空格分割的多个 Token.</li>
</ol>
</li>
</ol>
</li>
<li><code>latest_result</code>: 最新结果.
<ol>
<li>点击链接会跳转采集到的 <code>url</code> 参数指定的网址, 如果未指定, 则会跳转到任务 meta 里的 <code>origin_url</code> 地址.</li>
<li>点击三个点按钮的话, 则显示的是整个结果列表, 包括抓取到的时间.</li>
</ol>
</li>
<li><strong>注意</strong>: 有一行的任务是橘黄色的, 表示任务抓取出错了, 具体错误可以点击最新结果那列里的感叹号标识, 抓取报错的情况下, 一般不会入库存储算做最新结果, 除非是找不到规则.</li>
</ol>
</li>
<li>任务操作栏.
<ol>
<li>任务开关, 如果是关闭的任务, 除非强制抓取, 否则将不会再被抓取.</li>
<li>强制抓取. 跳过抓取间隔队列, 强制抓取一次本任务, 会刷新该任务各项 meta, 也会影响下次抓取时间的调度.</li>
<li>修改任务. 修改该行任务的各项 meta 信息.
<ol>
<li>快捷方式: 双击该行.</li>
</ol>
</li>
<li>删除任务. 会有一次确认弹窗.</li>
</ol>
</li>
<li>加载下一页.</li>
<li>四个页面操作的小按钮.
<ol>
<li>刷新本页. 会重新从第一页获取任务列表.</li>
<li>RSS 链接. 使用加盐 Token 来避开 Cookie 的验证, 适合给 RSS 阅读器进行订阅.
<ol>
<li>由于默认抓取循环的扫描间隔是 60 秒, 所以 RSS 更新的频率不要低于 60 秒.</li>
</ol>
</li>
<li>适配移动端 Lite 页面链接. 使用加盐 Token 来避开 Cookie 的验证. 点击顶部大标题可以跳回首页.<img src="/blog/images/watchdogs_3.png" alt=""></li>
<li>自定义链接. 存放于 <code>watchdogs.Config.custom_links</code> 的快捷方式, 方便记录一些经常需要访问的地址. 默认已经放了修改密码与查看日志的页面.</li>
</ol>
</li>
</ol>
<h4 id="任务信息">任务信息</h4>
<p><img src="/blog/images/watchdogs_4.png" alt=""></p>
<ol>
<li>任务的自增 ID, 不可修改.
<ol>
<li>任务信息页面如果是新建任务时打开的, 这里为空, 会由后端自动生成.</li>
<li>任务信息如果是任务列表双击打开的, 这里会是一个整数, 用于定位到数据库中的位置, 方便修改 meta 信息</li>
</ol>
</li>
<li>错误信息, 出错时会导致正行变成橘红色.</li>
<li>修改 <code>request_args</code> 的一些方便复制粘贴的常用参数, 比如超时和重试, 以及忽略 <code>ssl</code> 验证避免证书报错.</li>
<li>当抓取结果里没有 <code>url</code> 的时候, <code>origin_url</code> 会用来跳转.</li>
<li>快速选择抓取间隔, 省去计算秒数的时间.</li>
<li>前文提过的 <code>work_hours</code> 文档点击信息图标即可看到了.</li>
<li>历史列表的最大保存数量, 避免保存太多浪费存储.</li>
</ol>
<h3 id="tab-new">[Tab] New</h3>
<blockquote>
<p>此处是新建任务时使用</p>
</blockquote>
<p><img src="/blog/images/watchdogs_2.png" alt=""></p>
<ol>
<li>基于 <a href="https://github.com/ClericPy/uniparser">uniparser</a> 子 app 的 <code>iframe</code> 托管, 所以可以直接去其官网查看具体使用文档.</li>
<li>规则的名称, 一般留空, 等待点击 [Download] 按钮以后会自动获取一个, 到时候再略微修改即可.</li>
<li>用于识别网址是否匹配该规则的正则表达式, 一般留空, 使用下文所述的 [<code>cURL Parse</code>] 功能即可自动生成, 为了匹配更多网址, 可能要稍微修改其中部分变量为 <code>.*?</code></li>
<li>编码, 默认不指定的话会由 <code>requests</code> 或者 <code>aiohttp</code> 自带的 <code>chardet</code> 库进行识别.</li>
<li>通过此处来设置 <code>request_args</code> 参数会节省很多力气, 点击后填入 URL 或者一段标准 <code>cURL</code> 字符串 ( 比如在 <code>Chrome devtools console -&gt; Network -&gt; Copy as cURL</code> ), 将自动转为 requests 请求的标准字典.
<ol>
<li>并且如果 Regex Pattern 参数为空, 则自动填入一段, 然后由用户自行微调.</li>
</ol>
</li>
<li>可以在此处对请求的字典参数进行细致调整
<ol>
<li><strong>注:</strong> 因为这里是配置的规则层面的 <code>request_args</code>, 在真正发起请求的时候, 将会被 Task 层面的 <code>request_args</code>所覆盖.</li>
</ol>
</li>
<li>下载按钮. 点击后如果 Rule Name 没有配置, 则会自动填入请求结果里的 title 或 h1 标签内容, 否则填入一个当前时间戳的字符串.</li>
<li>发送请求后的响应主体. 会显示请求的状态码和 body.</li>
<li>具体的解析规则. 配置方式可以参考 <a href="https://github.com/ClericPy/uniparser">uniparser</a> 官网.
<ol>
<li>每次点击 Parse 按钮即可查看已经配置的解析结果.</li>
</ol>
</li>
<li>初始化一份解析规则方便二次修改. 多次点击会在两种 Demo 之间切换.
<ol>
<li>一种是 CSS 选择器解析方式的 Demo</li>
<li>另一种则是 XML 解析的 Demo, 这种主要是用来处理 <strong>RSS</strong>.</li>
</ol>
</li>
<li>保存当前配置好的抓取规则.
<ol>
<li>一定要确保解析结果符合要求:
<ol>
<li>结果里一定要有 <code>text</code> 字段</li>
<li>结果里可以有 <code>url</code> 字段, 如果没有则会被 <code>Task.origin_url</code> 所替代</li>
<li>结果可以是字典, 也可以是列表里的字典, 如果是列表会被倒序存入历史列表.
<ol>
<li><code>{'text': 'some text', 'url': 'http://example.com'}</code></li>
<li><code>[{'text': 'some text', 'url': 'http://example.com'}, {'text': 'some text2', 'url': 'http://example2.com'}]</code></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>创建新任务.
<ol>
<li>默认会根据当前规则填入一些空白参数, 略做微调即可.</li>
<li>提交后可以去 Tasks 页面点强制抓取, 不用等下一次循环.</li>
<li>具体任务各项 meta 信息在页面上基本都有文档来参考.</li>
<li>所以, 最简单的创建一个任务来参考的方式就是:
<ol>
<li>点击 <code>Init</code> 按钮</li>
<li>点击 <code>Download</code> 按钮</li>
<li>点击 <code>Save Crawler Rule</code> 按钮</li>
<li>点击 <code>Add New Task</code> 按钮</li>
<li>点击提交即可</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="tab-rule">[Tab] Rule</h3>
<blockquote>
<p>规则列表页面, 按照 host name 进行归类</p>
</blockquote>
<p><img src="/blog/images/watchdogs_5.png" alt=""></p>
<ol>
<li>可以输入 host 片段对所有 host 进行过滤, 按下回车或点击搜索按钮则会重新去服务器获取.</li>
<li>每个 host 是一个可以点击的彩色 Tag, 点击后出现详细信息的弹窗</li>
<li>规则信息弹窗, 在数据库中也是按 host name 索引的</li>
<li>删除整个 <code>HostRule</code>, 整行删除</li>
<li>控制该 host 下的所有请求抓取频率, 避免因为抓取频率过快而触发反爬
<ol>
<li>默认不限制并发数和抓取间隔</li>
<li>举个例子, n 设置为 3, interval 设置为 1, 表示 1 秒里最多发起 3 次请求</li>
</ol>
</li>
<li>之前新建任务时候起的倒霉名字, 如果想修改, 点击这里就会跳转过去, 修改完再次 Save 即可.
<ol>
<li>注意: 因为 <code>CrawlerRule</code> 在 <code>HostRule</code> 里面是拿 name 做 key 的, 所以会有一次覆盖确认.</li>
</ol>
</li>
<li>和上面一样, 点击后跳转到该条 <code>CrawlerRule</code> 的修改页面</li>
<li>将该条抓取规则直接当成 <code>JSON</code> 修改, 适合较熟悉的使用, 在 <code>uniparser</code> 里, 所有规则都是可持久化的, 因为它们都继承了 <code>dict</code> 类</li>
<li>删除该抓取规则, 因为是二次弹出的页面, 所以不太需要二次确认了, 点击就会删除</li>
</ol>
<h3 id="自定义使用">自定义使用</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> fastapi <span style="color:#f92672">import</span> FastAPI, Request
<span style="color:#f92672">from</span> uvicorn <span style="color:#f92672">import</span> run
<span style="color:#f92672">from</span> watchdogs <span style="color:#f92672">import</span> Config, init_app

<span style="color:#75715e"># 更新默认的 Config 为自定义参数</span>
Config<span style="color:#f92672">.</span>db_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mysql+pymysql://root:password@172.1.2.3:3306/db?charset=utf8mb4&#39;</span>

app: FastAPI <span style="color:#f92672">=</span> init_app()


<span style="color:#a6e22e">@app.get</span>(<span style="color:#e6db74">&#39;/new_page&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">new_page</span>(request: Request):
    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;method&#39;</span>: request<span style="color:#f92672">.</span>method}


run(app, <span style="color:#f92672">**</span>Config<span style="color:#f92672">.</span>uvicorn_kwargs)

</code></pre></div><h2 id="结语">结语</h2>
<p>​		整个项目框架搭起来用了大概半个月, 然而后续小 bug 层出不穷, 再加上很多功能优化, 断断续续发了很多版本改了很长时间. 其实之前也尝试过做了一个 <code>onwebchange</code> 的库, 但是各种设计都太稚嫩, 所以想了想本着 2.0 的思路重新从 <code>uniparser</code> 开始搞, 也算把很久以前存放在 <code>todoist</code> 里的想法清理了一遍.</p>
<p>​		英文文档远没有中文文档详细, 遇到问题可以通过 <a href="https://github.com/ClericPy/watchdogs">Github issues</a>.</p>
<p>​		截止到 2020-03-31, 功能基本已经完整, 之后不再计划太频繁的非 bug 更新.</p>

                </div>
                

                


                
                
                <div style="height: 50px;"></div>
                
                

                <div class="site-footer">
  
  <div class="site-footer-item">
    <a href="https://www.clericpy.top/newspaper/articles.query.html" target="_blank">News</a>
  </div>
  
  <div class="site-footer-item">
    <a href="/blog/index.xml" target="_blank">RSS</a>
  </div>
  
  <div class="site-footer-item">
    <a href="/blog/categories/" target="_blank">Categories</a>
  </div>
  
  <div class="site-footer-item">
    <a href="https://github.com/ClericPy/blog/issues" target="_blank">Issue</a>
  </div>
  
  <div class="site-footer-item">
    <a href="/blog/about" target="_blank">About</a>
  </div>
  
  
</div>

            </div>
        </div>
    </article>

    <script src="/blog/js/highlight.pack.js"></script>
<script src="https://unpkg.com/quicklink@0.1.1/dist/quicklink.umd.js"></script>

<script>
  hljs.initHighlightingOnLoad();
  
  var posts = document.getElementById('posts-list');
  posts && quicklink({
    el: posts,
    priority: true,
  });
</script>

    

</body>

</html>
